{% extends "base.html" %}

{% block header %}Analyse{% endblock %}

{% block content %}
<div class="space-y-8" x-data="{
    score: 0,
    typeDist: {},
    totalValue: 0,
    init() {
        const data = JSON.parse(document.getElementById('view-data').textContent);
        this.score = data.score;
        this.typeDist = data.type_distribution;
        this.totalValue = data.total_value;
    }
}">
    <script type="application/json" id="view-data">
        {
            "score": {{ score|default(0)|tojson }},
            "type_distribution": {{ type_distribution|default({})|tojson }},
            "total_value": {{ total_value|default(0)|tojson }}
        }
    </script>

    <!-- Header -->
    <div class="space-y-1">
        <h2 class="text-2xl font-bold tracking-tight text-white flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="text-indigo-400">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
            </svg>
            Analyse Approfondie
        </h2>
        <p class="text-sm text-zinc-400">Insights et recommandations pour optimiser votre portefeuille</p>
    </div>

    <!-- Top Grid: Diversification & Simulator -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- Score de Diversification -->
        <div
            class="rounded-xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm p-6 flex flex-col justify-between">
            <div>
                <h3 class="flex items-center gap-2 text-sm font-semibold text-white mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-indigo-400">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                    </svg>
                    Score de Diversification
                </h3>

                <div class="flex flex-col items-center justify-center mb-8">
                    <div
                        class="text-5xl font-bold {{ 'text-green-400' if score >= 70 else ('text-yellow-400' if score >= 50 else 'text-red-400') }} mb-2">
                        {{ "%.0f"|format(score) }}</div>
                    <span
                        class="px-2 py-0.5 rounded text-[10px] font-bold {{ 'bg-green-500/20 text-green-400' if score >= 70 else ('bg-yellow-500/20 text-yellow-400' if score >= 50 else 'bg-red-500/20 text-red-400') }} border {{ 'border-green-500/30' if score >= 70 else ('border-yellow-500/30' if score >= 50 else 'border-red-500/30') }}">{{
                        div_level|upper }}</span>
                </div>

                <div class="space-y-2 mb-8">
                    <div class="flex justify-between text-xs text-zinc-400">
                        <span>Niveau de diversification</span>
                        <span>{{ "%.0f"|format(score) }}%</span>
                    </div>
                    <div class="h-2 w-full bg-slate-800 rounded-full overflow-hidden">
                        <div class="h-2 w-full bg-slate-800 rounded-full overflow-hidden">
                            <div class="h-full rounded-full transition-all duration-1000"
                                :class="score >= 70 ? 'bg-green-500' : (score >= 50 ? 'bg-yellow-500' : 'bg-red-500')"
                                :style="'width: ' + score + '%'"></div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h4 class="text-xs font-semibold text-zinc-500 uppercase flex items-center gap-2">
                        <span
                            class="w-2 h-2 rounded-full border {{ 'border-green-500' if score >= 70 else ('border-yellow-500' if score >= 50 else 'border-red-500') }}"></span>
                        Répartition par type
                    </h4>
                    <!-- Asset Type Bars -->
                    <template x-for="(val, type) in typeDist" :key="type">
                        <div class="flex items-center text-xs">
                            <span class="w-24 text-zinc-400 capitalize" x-text="type"></span>
                            <div class="flex-1 h-1.5 bg-slate-800 rounded-full mx-2">
                                <div class="h-full bg-indigo-500/80 rounded-full"
                                    :style="'width: ' + (totalValue > 0 ? (val / totalValue * 100) : 0) + '%'">
                                </div>
                            </div>
                            <span class="w-10 text-right text-white font-medium"
                                x-text="(totalValue > 0 ? (val / totalValue * 100) : 0).toFixed(1) + '%'"></span>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Recommendation Box -->
            <div class="mt-8 p-4 rounded-lg bg-indigo-500/5 border border-indigo-500/10">
                <h4 class="text-xs font-semibold text-zinc-300 mb-2">Recommandations</h4>
                <ul class="space-y-1">
                    {% for rec in div_recs %}
                    <li class="text-xs text-indigo-300/80 flex items-start gap-2">
                        <span class="text-indigo-400">•</span> {{ rec }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Simulateur de Scénarios -->
        <div x-data="{ 
                marketChange: 0, 
                currentValue: {{ total_value }},
                get newValue() { return this.currentValue * (1 + this.marketChange / 100); },
                get delta() { return this.newValue - this.currentValue; }
             }" class="rounded-xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm p-6">

            <h3 class="flex items-center gap-2 text-sm font-semibold text-white mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="text-indigo-400">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                </svg>
                Simulateur de Scénarios
            </h3>

            <!-- Slider -->
            <div class="mb-8">
                <div class="flex justify-between text-xs text-zinc-400 mb-4">
                    <span>Variation du marché: <span
                            x-text="marketChange > 0 ? '+' + marketChange : marketChange"></span>%</span>
                </div>
                <input type="range" x-model.number="marketChange" min="-50" max="50" step="5"
                    class="w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer accent-indigo-500">
                <div class="flex justify-between text-[10px] text-zinc-600 mt-2">
                    <span>-50%</span>
                    <span>0%</span>
                    <span>+50%</span>
                </div>
            </div>

            <!-- Value Cards -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-slate-800/50 border border-slate-700/50 p-4 rounded-xl">
                    <div class="text-[10px] text-zinc-500 uppercase tracking-wider mb-1">Valeur actuelle</div>
                    <div class="text-xl font-bold text-white">{{ "%.2f"|format(total_value) }} €</div>
                </div>
                <!-- Dynamic Sim Value -->
                <div class="bg-slate-800/50 border p-4 rounded-xl relative overflow-hidden transition-colors duration-300"
                    :class="delta >= 0 ? 'border-green-500/30' : 'border-red-500/30'">
                    <div class="text-[10px] text-zinc-500 uppercase tracking-wider mb-1">Valeur simulée</div>
                    <div class="text-xl font-bold transition-colors duration-300"
                        :class="delta >= 0 ? 'text-green-400' : 'text-red-400'"
                        x-text="newValue.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €'">
                    </div>
                    <div class="text-[10px] font-medium mt-1 flex items-center gap-1 transition-colors duration-300"
                        :class="delta >= 0 ? 'text-green-500' : 'text-red-500'">
                        <span x-show="delta >= 0">↗</span><span x-show="delta < 0">↘</span>
                        <span
                            x-text="(delta >= 0 ? '+' : '') + delta.toLocaleString('fr-FR', { minimumFractionDigits: 0 }) + ' €'"></span>
                    </div>
                </div>
            </div>

            <!-- Scenarios Buttons -->
            <div class="mb-8">
                <div class="text-xs font-semibold text-zinc-300 mb-3">Scénarios pré-définis</div>
                <div class="flex flex-wrap gap-2">
                    <button @click="marketChange = -30"
                        class="px-2 py-1 bg-red-500/10 text-red-500 border border-red-500/20 rounded text-[10px] hover:bg-red-500/20 transition-colors">Crash
                        -30%</button>
                    <button @click="marketChange = -15"
                        class="px-2 py-1 bg-orange-500/10 text-orange-500 border border-orange-500/20 rounded text-[10px] hover:bg-orange-500/20 transition-colors">Correction
                        -15%</button>
                    <button @click="marketChange = 0"
                        class="px-2 py-1 bg-slate-500/10 text-slate-400 border border-slate-500/20 rounded text-[10px] hover:bg-slate-500/20 transition-colors">Stagnation
                        0%</button>
                    <button @click="marketChange = 15"
                        class="px-2 py-1 bg-green-500/10 text-green-500 border border-green-500/20 rounded text-[10px] hover:bg-green-500/20 transition-colors">Croissance
                        +15%</button>
                    <button @click="marketChange = 30"
                        class="px-2 py-1 bg-emerald-500/10 text-emerald-500 border border-emerald-500/20 rounded text-[10px] hover:bg-emerald-500/20 transition-colors">Bull
                        run +30%</button>
                </div>
            </div>

            <!-- Impact By Class -->
            <div>
                <div class="text-xs font-semibold text-zinc-300 mb-3">Impact par classe d'actif</div>
                <div class="bg-slate-800/50 rounded-lg p-3 space-y-2">
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-zinc-400">Actions (volatilité x1.2)</span>
                        <span class="text-white font-medium" x-text="(marketChange * 1.2).toFixed(1) + '%'"></span>
                    </div>
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-zinc-400">Crypto (volatilité x2)</span>
                        <span class="text-white font-medium" x-text="(marketChange * 2).toFixed(1) + '%'"></span>
                    </div>
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-zinc-400">Obligations (volatilité x0.5)</span>
                        <span class="text-white font-medium" x-text="(marketChange * 0.5).toFixed(1) + '%'"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparaison Benchmarks -->
    <div class="rounded-xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm p-6">
        <h3 class="flex items-center gap-2 text-sm font-semibold text-white mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="text-indigo-400">
                <path d="M3 3v18h18" />
                <path d="m19 9-5 5-4-4-3 3" />
            </svg>
            Comparaison avec les Benchmarks
        </h3>

        <!-- Cards Row -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <div class="bg-slate-800/50 border border-slate-700/50 p-4 rounded-xl">
                <div class="text-[10px] text-zinc-500 mb-1">Votre Portfolio</div>
                <div class="text-lg font-bold text-white">{{ "%.1f"|format(performance) }}% <span
                        class="{{ 'text-green-500' if performance >= 0 else 'text-red-500' }} text-xs">{{ '↗' if
                        performance >= 0 else '↘' }}</span></div>
            </div>
            <div class="bg-slate-800/50 border border-slate-700/50 p-4 rounded-xl">
                <div class="text-[10px] text-zinc-500 mb-1">CAC 40</div>
                <div class="text-lg font-bold text-white">+8.3% <span class="text-green-500 text-xs">↗</span></div>
            </div>
            <div class="bg-slate-800/50 border border-slate-700/50 p-4 rounded-xl">
                <div class="text-[10px] text-zinc-500 mb-1">S&P 500</div>
                <div class="text-lg font-bold text-white">+15.2% <span class="text-green-500 text-xs">↗</span></div>
            </div>
            <div class="bg-slate-800/50 border border-slate-700/50 p-4 rounded-xl">
                <div class="text-[10px] text-zinc-500 mb-1">Bitcoin</div>
                <div class="text-lg font-bold text-white">+45.7% <span class="text-green-500 text-xs">↗</span></div>
            </div>
            <div class="bg-slate-800/50 border border-slate-700/50 p-4 rounded-xl">
                <div class="text-[10px] text-zinc-500 mb-1">Or</div>
                <div class="text-lg font-bold text-white">+3.1% <span class="text-green-500 text-xs">↗</span></div>
            </div>
        </div>

        <!-- Chart -->
        <div class="mb-4">
            <div class="text-xs font-semibold text-zinc-300 mb-4">Performance sur 12 mois (base 100)</div>
            <div class="h-64 w-full">
                <canvas id="benchmarkChart"></canvas>
            </div>
        </div>

        <!-- Info Alert -->
        <div class="bg-indigo-500/10 border border-indigo-500/20 rounded-lg p-3 flex items-center gap-2">
            <div class="w-1.5 h-1.5 rounded-full bg-yellow-400 animate-pulse"></div>
            <span class="text-xs text-indigo-300">Votre portefeuille {{ 'surperforme' if performance > 8.3 else
                'sous-performe' }} le CAC 40 de {{ "%.1f"|format((performance - 8.3)|abs) }} points.</span>
        </div>
    </div>

    <!-- AI Recommendations (Mocked with Alpine) -->
    <div x-data="{ loading: false, showRecs: false, 
         generate() { 
             this.loading = true; 
             setTimeout(() => { 
                 this.loading = false; 
                 this.showRecs = true; 
             }, 2000); 
         } 
    }" class="rounded-xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm p-6 relative overflow-hidden">

        <!-- Decoration -->
        <div class="absolute top-0 right-0 p-32 bg-indigo-500/5 rounded-full blur-3xl pointer-events-none"></div>

        <div class="flex justify-between items-center mb-12 relative z-10">
            <h3 class="flex items-center gap-2 text-sm font-semibold text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="text-indigo-400">
                    <path
                        d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
                    <path d="M5 3v4" />
                    <path d="M9 3v4" />
                    <path d="M3 5h4" />
                    <path d="M3 9h4" />
                </svg>
                Recommandations IA
            </h3>
            <button @click="generate()" :disabled="loading"
                class="px-3 py-1.5 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded text-xs font-medium shadow-lg shadow-indigo-500/30 transition-all flex items-center gap-2">
                <span x-show="!loading" class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
                    </svg>
                    Générer
                </span>
                <span x-show="loading" class="flex items-center gap-2">
                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    Analyse...
                </span>
            </button>
        </div>

        <div x-show="!showRecs && !loading"
            class="flex flex-col items-center justify-center text-center py-8 relative z-10 transition-opacity">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="text-zinc-600 mb-4">
                <path
                    d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
            </svg>
            <p class="text-xs text-zinc-500 mb-1">Cliquez sur "Générer" pour obtenir des recommandations personnalisées
                basées sur l'IA</p>
        </div>

        <div x-show="loading" style="display: none;"
            class="flex flex-col items-center justify-center text-center py-8 relative z-10">
            <svg class="animate-spin h-8 w-8 text-indigo-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            <p class="text-slate-300 text-sm">Analyse de votre portefeuille en cours...</p>
        </div>

        <!-- Recommendations List -->
        <div x-show="showRecs && !loading" style="display: none;" class="space-y-4">
            <!-- Rec 1: Diversification -->
            <div class="border border-blue-500/50 bg-blue-500/10 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center bg-blue-500/20 text-blue-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        </svg>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                            <h4 class="text-white font-semibold">Diversifiez vos investissements</h4>
                            <span
                                class="text-xs px-1.5 py-0.5 border border-blue-400 rounded text-blue-400">Prioritaire</span>
                        </div>
                        <p class="text-sm text-slate-300">Ajoutez des actifs de différentes classes (Or, Obligations)
                            pour réduire le risque global de votre exposition Crypto.</p>
                    </div>
                </div>
            </div>

            <!-- Rec 2: Opportunity -->
            <div class="border border-green-500/50 bg-green-500/10 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center bg-green-500/20 text-green-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 7 13.5 15.5 8.5 10.5 2 17" />
                            <polyline points="16 7 22 7 22 13" />
                        </svg>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                            <h4 class="text-white font-semibold">Renforcez vos positions stables</h4>
                            <span
                                class="text-xs px-1.5 py-0.5 border border-green-400 rounded text-green-400">Suggestion</span>
                        </div>
                        <p class="text-sm text-slate-300">Considérez l'augmentation de votre allocation en Stablecoins
                            pour profiter des opportunités lors des prochaines corrections.</p>
                    </div>
                </div>
            </div>

            <!-- Rec 3: Risk -->
            <div class="border border-red-500/50 bg-red-500/10 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center bg-red-500/20 text-red-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <circle cx="12" cy="12" r="6" />
                            <circle cx="12" cy="12" r="2" />
                        </svg>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                            <h4 class="text-white font-semibold">Surveillance de la volatilité</h4>
                            <span
                                class="text-xs px-1.5 py-0.5 border border-red-400 rounded text-red-400">Important</span>
                        </div>
                        <p class="text-sm text-slate-300">Votre portefeuille a une volatilité élevée. Activez des
                            alertes de prix sur vos actifs principaux.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    Chart.defaults.color = '#71717a';
    Chart.defaults.borderColor = '#27272a';

    const ctx = document.getElementById('benchmarkChart').getContext('2d');

    // Helper to generate ascending line
    const ln = (start, growth) => Array.from({ length: 12 }, (_, i) => start + (i * growth));

    // Get real portfolio performance if available, otherwise mock
    const userPerf = Number("{{ performance | default (12.5) }}");
    const userGrowth = userPerf / 10; // Rough approx for line slope

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7', 'M8', 'M9', 'M10', 'M11', 'M12'],
            datasets: [
                {
                    label: 'Votre Portfolio',
                    data: ln(100, userGrowth > 0 ? userGrowth : 0.5),
                    borderColor: '#6366f1',
                    borderWidth: 2,
                    pointRadius: 2,
                    tension: 0.4
                },
                {
                    label: 'CAC 40',
                    data: ln(100, 0.7),
                    borderColor: '#22c55e',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4
                },
                {
                    label: 'S&P 500',
                    data: ln(100, 1.4),
                    borderColor: '#f59e0b',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4
                },
                {
                    label: 'Bitcoin',
                    data: ln(100, 3.5),
                    borderColor: '#ec4899',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        boxWidth: 8,
                        usePointStyle: true,
                        pointStyle: 'circle',
                        font: { size: 10 }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(15, 23, 42, 0.9)',
                    borderColor: 'rgba(148, 163, 184, 0.2)',
                    borderWidth: 1,
                    padding: 10,
                    displayColors: true,
                    callbacks: {
                        label: function (context) {
                            return context.dataset.label + ': ' + context.parsed.y.toFixed(1);
                        }
                    }
                }
            },
            scales: {
                y: {
                    grid: { color: 'rgba(39, 39, 42, 0.5)' },
                    suggestedMin: 50,
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
</script>
{% endblock %}