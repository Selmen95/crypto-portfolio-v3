{% extends "base.html" %}

{% block header %}Alertes{% endblock %}

{% block content %}
<div x-data="{ showForm: false }">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1
                    class="text-4xl font-bold text-white mb-2 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                    Alertes de Prix
                </h1>
                <p class="text-slate-400 text-lg">
                    Soyez notifié quand vos actifs atteignent un prix cible
                </p>
            </div>

            <button @click="showForm = true" x-show="!showForm"
                class="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Nouvelle Alerte
            </button>
        </div>

        <!-- Add Alert Form (Collapsible) -->
        <div x-show="showForm" style="display: none;" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 y-[-20px]" x-transition:enter-end="opacity-100 y-0" class="mb-8">

            <div class="rounded-xl border border-zinc-800 bg-[#1e1e24] p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-sm font-semibold text-white uppercase tracking-wide">Nouvelle Alerte de Prix</h3>
                    <button @click="showForm = false" class="text-zinc-500 hover:text-white"><svg
                            xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg></button>
                </div>

                <form action="{{ url_for('add_alert') }}" method="POST" class="space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-medium text-zinc-400">Symbole (ex: BTC)</label>
                            <input type="text" name="symbol" required placeholder="BTC"
                                class="w-full bg-[#13131a] border border-zinc-800 text-zinc-300 text-sm rounded-lg p-2.5 placeholder-zinc-600 focus:ring-indigo-500 focus:border-indigo-500 uppercase">
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-medium text-zinc-400">Condition</label>
                            <select name="condition"
                                class="w-full bg-[#13131a] border border-zinc-800 text-zinc-300 text-sm rounded-lg p-2.5 focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="above">Au-dessus de</option>
                                <option value="below">En-dessous de</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-medium text-zinc-400">Prix cible (€)</label>
                        <input type="number" name="target_price" step="any" required placeholder="50000"
                            class="w-full bg-[#13131a] border border-zinc-800 text-zinc-300 text-sm rounded-lg p-2.5 placeholder-zinc-600 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <div class="flex items-center justify-end gap-3 pt-2">
                        <button type="button" @click="showForm = false"
                            class="px-4 py-2 text-sm font-medium text-zinc-300 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors border border-zinc-700/50">
                            Annuler
                        </button>
                        <button type="submit"
                            class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-500 rounded-lg transition-colors shadow-lg shadow-indigo-500/20">
                            Créer l'alerte
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Active Alerts Section -->
        <div class="space-y-6">
            <div>
                <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-indigo-400">
                        <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" />
                        <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" />
                    </svg>
                    Alertes Actives ({{ alerts|length }})
                </h2>

                {% if alerts %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for alert in alerts %}
                    <div
                        class="rounded-xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm hover:border-indigo-500/30 transition-all p-4">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <h3 class="font-semibold text-white text-lg">{{ alert.symbol }}</h3>
                                <span
                                    class="text-xs font-medium px-2 py-0.5 rounded border border-slate-600 text-slate-400 mt-1 inline-block">Crypto</span>
                            </div>
                            {% if alert.condition == 'above' %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="text-green-400">
                                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17" />
                                <polyline points="16 7 22 7 22 13" />
                            </svg>
                            {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="text-red-400">
                                <polyline points="22 17 13.5 8.5 8.5 13.5 2 6" />
                                <polyline points="16 17 22 17 22 11" />
                            </svg>
                            {% endif %}
                        </div>

                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-400">Condition:</span>
                                <span class="text-white">{{ "Au-dessus de" if alert.condition == "above" else
                                    "En-dessous de" }}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-400">Prix cible:</span>
                                <span class="text-indigo-400 font-semibold">{{ "%.2f"|format(alert.target_price) }}
                                    €</span>
                            </div>
                        </div>

                        <a href="/delete_alert/{{ loop.index0 }}"
                            class="flex items-center justify-center w-full px-3 py-2 text-sm font-medium text-red-400 border border-red-500/30 rounded-lg hover:bg-red-500/10 transition-colors">
                            Supprimer
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="rounded-xl border border-slate-800 bg-slate-900/50 p-12 text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-slate-600 mx-auto mb-4">
                        <circle cx="12" cy="12" r="10" />
                        <line x1="12" y1="8" x2="12" y2="12" />
                        <line x1="12" y1="16" x2="12.01" y2="16" />
                    </svg>
                    <p class="text-slate-400">Aucune alerte active</p>
                    <p class="text-slate-500 text-sm mt-2">Créez votre première alerte pour être notifié des mouvements
                        de prix</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}