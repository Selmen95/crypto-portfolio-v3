{% extends "base.html" %}

{% block header %}Apprendre{% endblock %}

{% block content %}
<div x-data="academyApp()" class="min-h-screen pb-12">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8 p-6">
            <h1
                class="text-4xl font-bold font-display text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400 mb-2 flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-indigo-400" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
                    <path d="M6 12v5c3 3 9 3 12 0v-5" />
                </svg>
                Acad√©mie Finance - Master Class
            </h1>
            <p class="text-slate-400 text-lg max-w-2xl">
                Une formation compl√®te, de l'histoire des march√©s aux formules math√©matiques avanc√©es.
            </p>
        </div>

        <div class="grid lg:grid-cols-4 gap-8 px-6">
            <!-- Sidebar Navigation -->
            <div class="lg:col-span-1 space-y-6">
                <div
                    class="bg-slate-900/80 border border-slate-800 backdrop-blur-md rounded-2xl p-4 sticky top-6 shadow-xl">
                    <h3 class="text-xs font-bold text-indigo-400 uppercase tracking-wider mb-4 px-2">Programme</h3>
                    <div class="space-y-1">
                        <template x-for="module in modules" :key="module.id">
                            <button @click="activeModule = module.id"
                                class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group"
                                :class="activeModule === module.id ? 'bg-indigo-600/20 text-indigo-300 border border-indigo-500/30' : 'hover:bg-slate-800 text-slate-400 hover:text-white'">
                                <span x-html="module.icon"
                                    class="w-5 h-5 opacity-75 group-hover:scale-110 transition-transform"></span>
                                <span class="font-medium text-sm" x-text="module.title"></span>
                                <div class="ml-auto flex items-center gap-2">
                                    <span
                                        class="text-[10px] px-2 py-0.5 rounded-full bg-slate-950 text-slate-500 font-mono"
                                        x-text="getModuleProgress(module) + '%'"></span>
                                </div>
                            </button>
                        </template>
                    </div>

                    <!-- Global Progress -->
                    <div class="mt-8 pt-6 border-t border-slate-800/50 px-2">
                        <div class="flex justify-between items-end mb-2">
                            <span class="text-xs font-medium text-slate-400">Progression Totale</span>
                            <span class="text-sm font-bold text-green-400" x-text="totalProgress + '%'"></span>
                        </div>
                        <div class="h-2 bg-slate-950 rounded-full overflow-hidden border border-slate-800">
                            <div class="h-full bg-gradient-to-r from-green-500 to-emerald-400 rounded-full transition-all duration-700 ease-out"
                                :style="`width: ${totalProgress}%`"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content List -->
            <div class="lg:col-span-3">
                <div
                    class="bg-slate-900/50 border border-slate-800 backdrop-blur-sm rounded-2xl p-8 min-h-[600px] shadow-2xl">
                    <!-- Module Header -->
                    <div class="flex items-start justify-between mb-10 border-b border-slate-800 pb-8">
                        <div>
                            <div
                                class="flex items-center gap-2 text-indigo-400 text-xs font-bold tracking-wider uppercase mb-2">
                                <span>Module</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M9 18l6-6-6-6" />
                                </svg>
                                <span x-text="currentModule.title"></span>
                            </div>
                            <h2 class="text-3xl font-bold text-white mb-3" x-text="currentModule.title"></h2>
                            <p class="text-slate-400 text-lg leading-relaxed" x-text="currentModule.description"></p>
                        </div>
                        <div
                            class="w-16 h-16 rounded-2xl bg-indigo-500/10 border border-indigo-500/20 flex items-center justify-center text-indigo-400 shadow-inner">
                            <span x-html="currentModule.icon" class="w-8 h-8"></span>
                        </div>
                    </div>

                    <!-- Lessons Grid -->
                    <div class="grid gap-4">
                        <template x-for="(lesson, index) in currentModule.lessons" :key="index">
                            <div @click="openLesson(lesson, index)"
                                class="group relative overflow-hidden rounded-xl bg-slate-800/40 border border-slate-700/50 hover:border-indigo-500/50 hover:bg-slate-800/80 transition-all duration-300 cursor-pointer">

                                <div class="p-6 flex items-center gap-6">
                                    <!-- Play/Check Icon -->
                                    <div class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center transition-all duration-500"
                                        :class="isCompleted(activeModule, index) ? 'bg-green-500/20 text-green-400 border border-green-500/50' : 'bg-slate-900 text-slate-500 border border-slate-700 group-hover:border-indigo-400 group-hover:text-indigo-400'">
                                        <template x-if="isCompleted(activeModule, index)">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24"
                                                fill="none" stroke="currentColor" stroke-width="3"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <polyline points="20 6 9 17 4 12" />
                                            </svg>
                                        </template>
                                        <template x-if="!isCompleted(activeModule, index)">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 ml-1"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <polygon points="5 3 19 12 5 21 5 3" />
                                            </svg>
                                        </template>
                                    </div>

                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-1">
                                            <span
                                                class="text-xs font-bold text-slate-500 uppercase tracking-wider">Le√ßon
                                                <span x-text="index + 1"></span></span>
                                            <span
                                                class="text-xs font-mono text-indigo-400 bg-indigo-500/10 px-2 py-0.5 rounded"
                                                x-text="lesson.duration"></span>
                                        </div>
                                        <h3 class="text-xl font-bold text-white group-hover:text-indigo-300 transition-colors mb-1"
                                            x-text="lesson.title"></h3>
                                        <p class="text-sm text-slate-400 line-clamp-1" x-text="lesson.preview"></p>
                                    </div>

                                    <div
                                        class="opacity-0 group-hover:opacity-100 transition-opacity -translate-x-4 group-hover:translate-x-0 duration-300 text-indigo-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24"
                                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round">
                                            <line x1="5" y1="12" x2="19" y2="12" />
                                            <polyline points="12 5 19 12 12 19" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- FULL SCREEN LESSON MODAL -->
        <div x-show="activeLesson" style="display: none;"
            class="fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6"
            x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">

            <!-- Backdrop -->
            <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm" @click="closeLesson()"></div>

            <!-- Modal Content -->
            <div class="bg-slate-900 border border-slate-700 w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl relative flex flex-col overflow-hidden"
                x-data="{ tab: 'historical' }">

                <!-- Modal Header -->
                <div class="p-6 border-b border-slate-700 bg-slate-900 z-10 flex justify-between items-start shrink-0">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span
                                class="px-2 py-1 rounded bg-indigo-500/20 text-indigo-300 text-xs font-bold uppercase tracking-wider">
                                Cours Complet
                            </span>
                            <span class="text-slate-500 text-xs font-mono" x-show="activeLesson"
                                x-text="activeLesson.duration"></span>
                        </div>
                        <h2 class="text-3xl font-bold text-white leading-tight" x-show="activeLesson"
                            x-text="activeLesson.title"></h2>
                    </div>
                    <button @click="closeLesson()"
                        class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>
                </div>

                <!-- Modal Body (Scrollable) -->
                <div class="flex-1 overflow-y-auto flex flex-col lg:flex-row">

                    <!-- Content Tabs -->
                    <div class="lg:w-3/4 p-8 space-y-8" x-show="activeLesson">

                        <!-- Tab Navigation -->
                        <div class="flex gap-4 border-b border-slate-800 pb-1 overflow-x-auto">
                            <button @click="tab = 'historical'"
                                :class="tab === 'historical' ? 'text-indigo-400 border-indigo-400' : 'text-slate-500 border-transparent hover:text-white'"
                                class="pb-3 border-b-2 font-medium text-sm flex items-center gap-2 whitespace-nowrap transition-colors">
                                <span>üèõÔ∏è</span> Historique
                            </button>
                            <button @click="tab = 'analytical'"
                                :class="tab === 'analytical' ? 'text-indigo-400 border-indigo-400' : 'text-slate-500 border-transparent hover:text-white'"
                                class="pb-3 border-b-2 font-medium text-sm flex items-center gap-2 whitespace-nowrap transition-colors">
                                <span>üîç</span> Analytique
                            </button>
                            <button @click="tab = 'quantitative'"
                                :class="tab === 'quantitative' ? 'text-indigo-400 border-indigo-400' : 'text-slate-500 border-transparent hover:text-white'"
                                class="pb-3 border-b-2 font-medium text-sm flex items-center gap-2 whitespace-nowrap transition-colors">
                                <span>üßÆ</span> Quantitatif
                            </button>
                            <button @click="tab = 'example'"
                                :class="tab === 'example' ? 'text-indigo-400 border-indigo-400' : 'text-slate-500 border-transparent hover:text-white'"
                                class="pb-3 border-b-2 font-medium text-sm flex items-center gap-2 whitespace-nowrap transition-colors">
                                <span>üí°</span> Exemple
                            </button>
                        </div>

                        <!-- Content Render -->
                        <div class="prose prose-invert prose-lg max-w-none">
                            <div x-show="tab === 'historical'" x-transition.opacity>
                                <h3 class="text-xl font-bold text-white mb-4">Contexte Historique</h3>
                                <div class="text-slate-300 leading-relaxed whitespace-pre-line"
                                    x-html="activeLesson.content.historical"></div>
                            </div>
                            <div x-show="tab === 'analytical'" x-transition.opacity style="display: none;">
                                <h3 class="text-xl font-bold text-white mb-4">Analyse Approfondie</h3>
                                <div class="text-slate-300 leading-relaxed whitespace-pre-line"
                                    x-html="activeLesson.content.analytical"></div>
                            </div>
                            <div x-show="tab === 'quantitative'" x-transition.opacity style="display: none;">
                                <h3 class="text-xl font-bold text-white mb-4">Approche Math√©matique</h3>
                                <div
                                    class="bg-slate-950 p-6 rounded-xl border border-slate-800 font-mono text-sm text-cyan-300 mb-6">
                                    <div x-html="activeLesson.content.quantitative_formula"></div>
                                </div>
                                <div class="text-slate-300 leading-relaxed whitespace-pre-line"
                                    x-html="activeLesson.content.quantitative_text"></div>
                            </div>
                            <div x-show="tab === 'example'" x-transition.opacity style="display: none;">
                                <h3 class="text-xl font-bold text-white mb-4">Cas Concret</h3>
                                <div class="bg-indigo-500/10 border-l-4 border-indigo-500 p-6 rounded-r-xl">
                                    <div class="text-slate-200 indent-4 leading-relaxed whitespace-pre-line"
                                        x-html="activeLesson.content.example"></div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Right Column: Quiz -->
                    <div class="lg:w-1/4 bg-slate-950/50 border-l border-slate-800 p-6 flex flex-col">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">Validation</h3>

                        <template x-if="!activeLesson.quizCompleted">
                            <div class="space-y-6 flex-1">
                                <p class="text-white text-lg font-medium" x-text="activeLesson.quiz.question"></p>
                                <div class="space-y-2">
                                    <template x-for="option in activeLesson.quiz.options">
                                        <button @click="checkQuiz(option)"
                                            class="w-full text-left p-4 rounded-xl border border-slate-700 bg-slate-800/50 hover:bg-slate-800 hover:border-indigo-400 transition-all text-sm text-slate-300">
                                            <span x-text="option"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <template x-if="activeLesson.quizCompleted">
                            <div class="text-center flex-1 flex flex-col items-center justify-center space-y-4">
                                <div
                                    class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center text-white mb-2 shadow-lg shadow-green-500/20">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12" />
                                    </svg>
                                </div>
                                <h4 class="text-2xl font-bold text-white">Bravo !</h4>
                                <p class="text-slate-400 text-sm">Vous avez valid√© cette le√ßon.</p>
                                <button @click="closeLesson()"
                                    class="mt-4 px-6 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-full font-medium transition-colors">
                                    Continuer
                                </button>
                            </div>
                        </template>

                        <!-- Error Message -->
                        <div x-show="quizError"
                            class="mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm text-center"
                            x-transition>
                            Mauvaise r√©ponse, r√©essayez !
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function academyApp() {
        return {
            activeModule: 'basics',
            activeLesson: null,
            activeLessonIndex: null,
            quizError: false,
            completedLessons: JSON.parse(localStorage.getItem('academy_progress_v2') || '{}'),

            modules: [
                {
                    id: 'basics',
                    title: '1. Les Fondamentaux',
                    description: 'Ma√Ætriser les piliers invisibles qui r√©gissent la valeur de l\'argent.',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>',
                    lessons: [
                        {
                            title: "L'Inflation",
                            preview: "L'ennemi silencieux de votre √©pargne.",
                            duration: "10 min",
                            content: {
                                historical: "L'inflation n'est pas un ph√©nom√®ne nouveau. De la Rome antique diluant l'argent de ses deniers jusqu'√† l'hyperinflation de Weimar en 1923 (o√π une miche de pain co√ªtait des milliards de marks), l'histoire mon√©taire est pav√©e de p√©riodes de perte de valeur de la monnaie. <br><br>Historiquement, l'or a souvent servi de refuge car sa quantit√© est difficile √† augmenter, contrairement √† la monnaie fiduciaire que les banques centrales peuvent imprimer.",
                                analytical: "Fondamentalement, l'inflation est une augmentation de la masse mon√©taire sup√©rieure √† la cr√©ation de richesses (biens et services). <br><br>Quand il y a plus d'argent pour acheter la m√™me quantit√© de biens, les prix montent. <br><br>Ce n'est pas que les prix augmentent, c'est que **la valeur de votre argent diminue**. Un taux d'inflation de 2% (cible BCE/FED) est jug√© sain pour encourager la consommation plut√¥t que la th√©saurisation.",
                                quantitative_formula: "Valeur Future = Valeur Actuelle / (1 + Taux Inflation)^Ann√©es",
                                quantitative_text: "Pour comprendre l'impact, utilisez la 'R√®gle de 72'. Divisez 72 par le taux d'inflation pour savoir en combien d'ann√©es votre pouvoir d'achat est divis√© par deux.<br><br>Exemple √† 4% d'inflation : 72 / 4 = 18 ans. Dans 18 ans, 100‚Ç¨ ne vaudront plus que l'√©quivalent de 50‚Ç¨ aujourd'hui.",
                                example: "Imaginez que vous cachez 10 000‚Ç¨ sous votre matelas en 2000. C'est le prix d'une petite voiture neuve √† l'√©poque.<br><br>En 2024, vous ressortez ces billets. Ils sont authentiques, mais vous ne pouvez plus acheter qu'une voiture d'occasion tr√®s us√©e ou un scooter haut de gamme. L'argent n'a pas boug√©, mais le monde autour a augment√© ses prix. C'est l'inflation."
                            },
                            quiz: {
                                question: "Si l'inflation est de 5% par an, que se passe-t-il pour 100‚Ç¨ gard√©s en cash ?",
                                options: ["Ils vaudront plus cher", "Ils perdent environ 5% de pouvoir d'achat par an", "Ils restent stables"],
                                correct: "Ils perdent environ 5% de pouvoir d'achat par an"
                            }
                        },
                        {
                            title: "Int√©r√™ts Compos√©s",
                            preview: "La 8√®me merveille du monde selon Einstein.",
                            duration: "15 min",
                            content: {
                                historical: "Le concept remonte aux Babyloniens (2000 av. JC), mais a √©t√© popularis√© √† la Renaissance par les banquiers italiens. Benjamin Franklin l'a d√©crit comme : 'L'argent fait de l'argent, et l'argent que l'argent fait, fait de l'argent'.",
                                analytical: "C'est l'effet exponentiel du r√©investissement des gains. La premi√®re ann√©e, vous gagnez des int√©r√™ts sur votre capital. La deuxi√®me ann√©e, vous gagnez des int√©r√™ts sur votre capital ET sur les int√©r√™ts de l'ann√©e 1.<br><br>C'est ce qui diff√©rencie la croissance lin√©aire (salaire) de la croissance exponentielle (capital).",
                                quantitative_formula: "A = P (1 + r)^t <br><span class='text-xs text-slate-500'>A=Montant final, P=Principal, r=Taux, t=Temps</span>",
                                quantitative_text: "La variable la plus puissante dans cette formule n'est pas le montant (P) ni le taux (r), mais le **temps (t)** car il est en exposant.<br><br>Doubler le temps a beaucoup plus d'impact que doubler le capital de d√©part.",
                                example: "Alice place 200‚Ç¨/mois de 25 √† 35 ans (10 ans) √† 8%, puis arr√™te tout versement mais laisse l'argent travailler jusqu'√† 65 ans.<br>Bob commence √† 35 ans et met 200‚Ç¨/mois jusqu'√† 65 ans (30 ans) √† 8%.<br><br>R√©sultat ? Alice a plus d'argent que Bob √† la fin, m√™me si elle a cotis√© 3x moins longtemps, car ses int√©r√™ts ont compos√© pendant plus longtemps."
                            },
                            quiz: {
                                question: "Quel est le facteur le plus puissant dans les int√©r√™ts compos√©s ?",
                                options: ["Le capital de d√©part", "Le taux d'int√©r√™t", "Le temps (la dur√©e)"],
                                correct: "Le temps (la dur√©e)"
                            }
                        },
                        {
                            title: "Actifs vs Passifs",
                            preview: "La base de l'intelligence financi√®re.",
                            duration: "8 min",
                            content: {
                                historical: "Popularis√© par Robert Kiyosaki dans 'P√®re Riche, P√®re Pauvre', ce concept simplifie la comptabilit√© traditionnelle pour les particuliers.",
                                analytical: "D√©finition simple : <br>- Un **Actif** met de l'argent dans votre poche (Dividendes, Loyer, Int√©r√™ts).<br>- Un **Passif** sort de l'argent de votre poche (Cr√©dit, Entretien, Taxes).<br><br>Beaucoup de gens pensent que leur r√©sidence principale est un actif, mais c'est souvent un passif (elle co√ªte de l'argent chaque mois) tant qu'elle n'est pas vendue ou lou√©e.",
                                quantitative_formula: "Cashflow = Revenus d'Actifs - D√©penses de Passifs",
                                quantitative_text: "L'objectif est d'accumuler suffisamment d'actifs pour que :<br>Revenus d'Actifs > D√©penses Totales.<br><br>C'est la d√©finition math√©matique de l'Ind√©pendance Financi√®re.",
                                example: "Vous achetez une voiture neuve 30 000‚Ç¨. C'est un passif : elle perd de la valeur, co√ªte en assurance et essence.<br><br>Vous achetez 30 000‚Ç¨ d'actions Coca-Cola. C'est un actif : vous recevez des dividendes chaque trimestre sans rien faire."
                            },
                            quiz: {
                                question: "Selon cette d√©finition, une voiture de collection qui prend de la valeur est-elle un actif ?",
                                options: ["Non, c'est toujours un passif", "Oui, car elle s'appr√©cie (gain potentiel)", "√áa d√©pend de l'assurance"],
                                correct: "Oui, car elle s'appr√©cie (gain potentiel)"
                            }
                        }
                    ]
                },
                {
                    id: 'markets',
                    title: '2. Bourse & March√©s',
                    description: 'Comprendre la m√©canique mondiale des √©changes de valeur.',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>',
                    lessons: [
                        {
                            title: "Actions (Stocks)",
                            preview: "√ätre propri√©taire des plus grandes entreprises.",
                            duration: "12 min",
                            content: {
                                historical: "La premi√®re action de l'histoire a √©t√© √©mise par la VOC (Compagnie n√©erlandaise des Indes orientales) en 1602 √† Amsterdam. Pour la premi√®re fois, on pouvait poss√©der une fraction d'une entreprise et partager ses risques et profits.",
                                analytical: "Une action conf√®re deux droits : <br>1. Droit de vote aux Assembl√©es G√©n√©rales.<br>2. Droit aux b√©n√©fices (Dividendes).<br><br>Le prix d'une action monte si les investisseurs anticipent que les profits futurs de l'entreprise vont augmenter.",
                                quantitative_formula: "PER = Cours de l'Action / B√©n√©fice Net par Action",
                                quantitative_text: "Le PER (Price Earning Ratio) indique combien d'ann√©es de b√©n√©fices vous payez pour acqu√©rir l'action.<br>Moyenne historique S&P500 : ~15-20.<br>Si PER = 50, l'action est ch√®re (l'entreprise doit cro√Ætre tr√®s vite pour justifier ce prix).",
                                example: "Vous achetez 1 action Apple. Vous √™tes copropri√©taire d'Apple. Si Apple vend beaucoup d'iPhones, l'entreprise gagne du cash. Elle peut soit vous le verser (dividende), soit le r√©investir (nouveaux produits) pour faire monter le cours de l'action."
                            },
                            quiz: {
                                question: "Que repr√©sente une action ?",
                                options: ["Une obligation de dette", "Une part de propri√©t√© d'une entreprise", "Un produit d√©riv√©"],
                                correct: "Une part de propri√©t√© d'une entreprise"
                            }
                        },
                        {
                            title: "ETF (Trackers)",
                            preview: "La r√©volution de l'investissement passif.",
                            duration: "10 min",
                            content: {
                                historical: "Invent√© par John Bogle (fondateur de Vanguard) en 1976. Il a √©t√© moqu√© √† l'√©poque ('Bogle's Folly') pour vouloir se contenter de la 'moyenne'. Aujourd'hui, les ETF g√®rent des milliers de milliards.",
                                analytical: "Au lieu de chercher l'aiguille dans la botte de foin (la meilleure action), on ach√®te toute la botte.<br>Un ETF S&P500 ach√®te automatiquement les 500 plus grandes entreprises US. Si une fait faillite, elle est remplac√©e automatiquement.",
                                quantitative_formula: "Diversification = R√©duction du Risque Idiosyncratique",
                                quantitative_text: "Avec une seule action, votre volatilit√© peut √™tre de 50%+. Avec 500 actions, la volatilit√© baisse drastiquement car les pertes des unes sont compens√©es par les gains des autres. <br>De plus, 90% des g√©rants professionnels ne battent pas leur indice de r√©f√©rence sur 10 ans.",
                                example: "Avec 500‚Ç¨, il est difficile d'acheter 1 action Apple, 1 Amazon, 1 Microsoft, etc. (trop cher).<br>Avec 500‚Ç¨ d'ETF S&P500, vous poss√©dez instantan√©ment une fraction de ces 500 g√©ants pour seulement quelques euros de frais par an."
                            },
                            quiz: {
                                question: "Quel est l'objectif principal d'un ETF ?",
                                options: ["Battre le march√© √† tout prix", "R√©pliquer la performance d'un indice", "Sp√©culer √† la baisse"],
                                correct: "R√©pliquer la performance d'un indice"
                            }
                        }
                    ]
                },
                {
                    id: 'crypto',
                    title: '3. Crypto & Web3',
                    description: 'La prochaine √©volution de l\'internet et de la monnaie.',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><line x1="12" y1="2" x2="12" y2="4"/><line x1="12" y1="20" x2="12" y2="22"/></svg>',
                    lessons: [
                        {
                            title: "Bitcoin & Blockchain",
                            preview: "L'or num√©rique incensurable.",
                            duration: "18 min",
                            content: {
                                historical: "31 Octobre 2008 : Satoshi Nakamoto publie le Whitepaper Bitcoin en r√©ponse √† la crise financi√®re. <br>3 Janvier 2009 : Le 'Genesis Block' est min√©. Pour la premi√®re fois, on peut envoyer de la valeur sans interm√©diaire bancaire.",
                                analytical: "Bitcoin r√©sout le probl√®me de la 'double d√©pense' sans autorit√© centrale gr√¢ce √† la Blockchain (un registre public distribu√©) et la Preuve de Travail (√©nergie).<br>C'est une monnaie :<br>- Rare (21 millions max)<br>- Incensurable<br>- D√©centralis√©e",
                                quantitative_formula: "Stock-to-Flow = Stock existant / Production annuelle",
                                quantitative_text: "Tous les 4 ans, le 'Halving' divise par 2 la production de nouveaux Bitcoins. Cela cr√©e un choc d'offre. Si la demande reste constante ou augmente alors que l'offre se rar√©fie, le prix monte math√©matiquement.",
                                example: "Pour envoyer 1 million d'euros aux USA un dimanche √† 3h du matin :<br>- Banque : Impossible avant lundi, frais √©lev√©s, d√©lais, justificatifs.<br>- Bitcoin : 10 minutes, quelques euros de frais, personne ne peut bloquer la transaction."
                            },
                            quiz: {
                                question: "Quelle est la limite maximale de Bitcoins qui existeront ?",
                                options: ["Infini (comme le dollar)", "21 Millions", "100 Millions"],
                                correct: "21 Millions"
                            }
                        },
                        {
                            title: "Smart Contracts (Ethereum)",
                            preview: "L'ordinateur mondial d√©centralis√©.",
                            duration: "15 min",
                            content: {
                                historical: "Vitalik Buterin propose Ethereum en 2013 car il trouve Bitcoin trop limit√© (seulement monnaie). Il veut cr√©er une blockchain programmable.",
                                analytical: "Un Smart Contract est un programme informatique ('Si X alors Y') qui s'ex√©cute automatiquement sur la blockchain sans tiers de confiance.<br>Cela permet la DeFi (Finance D√©centralis√©e), les NFT, les DAO, etc.",
                                quantitative_formula: "Gas Fees = Co√ªt pour ex√©cuter un calcul sur le r√©seau",
                                quantitative_text: "La valeur d'ETH vient de son utilit√©. Pour utiliser le r√©seau (envoyer des tokens, utiliser une appli), il faut payer du 'Gas' en ETH. Plus le r√©seau est utilis√©, plus ETH est demand√© et br√ªl√© (EIP-1559), ce qui le rend d√©flationniste.",
                                example: "Assurance retard avion d√©centralis√©e : <br>Vous achetez un billet. Le Smart Contract est connect√© aux donn√©es de vol. <br>Si l'avion a >2h de retard, le contrat vous rembourse automatiquement. Pas de paperasse, pas d'assureur qui essaie de ne pas payer. C'est du code."
                            },
                            quiz: {
                                question: "Qu'est-ce qu'un Smart Contract ?",
                                options: ["Un contrat papier intelligent", "Un programme auto-ex√©cutable sur la blockchain", "Un accord verbal"],
                                correct: "Un programme auto-ex√©cutable sur la blockchain"
                            }
                        }
                    ]
                },
                {
                    id: 'strategy',
                    title: '4. Strat√©gies Gagnantes',
                    description: 'Plans d\'action pour b√¢tir votre patrimoine.',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 20h.01"/><path d="M7 20v-4"/><path d="M12 20v-8"/><path d="M17 20V8"/><path d="M22 4v16"/></svg>',
                    lessons: [
                        {
                            title: "DCA (Investissement Programm√©)",
                            preview: "Battre la volatilit√© sans stress.",
                            duration: "10 min",
                            content: {
                                historical: "M√©thode √©prouv√©e par Benjamin Graham, le mentor de Warren Buffett. L'id√©e est de retirer l'√©motion de l'√©quation.",
                                analytical: "Le DCA (Dollar Cost Averaging) consiste √† investir la m√™me somme √† intervalle r√©gulier, quel que soit le prix.<br>- Quand c'est cher, vous achetez moins d'unit√©s.<br>- Quand c'est pas cher (krach), vous achetez plus d'unit√©s.<br>Cela lisse votre prix de revient moyen.",
                                quantitative_formula: "Prix Moyen < Prix Moyen du March√© (souvent)",
                                quantitative_text: "Statistiquement, le DCA bat le 'Timing the Market' (essayer d'acheter au plus bas) pour 90% des investisseurs, car personne ne sait quand est le point bas.",
                                example: "Vous investissez 100‚Ç¨ tous les mois sur Bitcoin.<br>Janvier (Prix 50k) : 0.002 BTC<br>F√©vrier (Prix 25k - Krach) : 0.004 BTC<br>Mars (Prix 50k) : 0.002 BTC<br><br>Vous avez accumul√© plus de BTC gr√¢ce au krach. Vous n'avez pas paniqu√©, vous avez profit√© des soldes automatiquement."
                            },
                            quiz: {
                                question: "Quel est l'avantage principal du DCA ?",
                                options: ["Acheter toujours au plus bas", "Lisser le prix d'entr√©e et √©viter le stress √©motionnel", "Gagner √† tous les coups √† court terme"],
                                correct: "Lisser le prix d'entr√©e et √©viter le stress √©motionnel"
                            }
                        },
                        {
                            title: "Allocation & R√©√©quilibrage",
                            preview: "La gestion de portefeuille des pros.",
                            duration: "12 min",
                            content: {
                                historical: "Th√©orie Moderne du Portefeuille (Markowitz, Prix Nobel 1952).",
                                analytical: "D√©finissez une cible (ex: 60% Actions, 40% Obligations).<br>Si les actions montent fort, elles deviennent 70% du portif. Vous √™tes surexpos√© au risque.<br>Le r√©√©quilibrage consiste √† vendre le trop-plein d'actions (vendre haut) pour racheter des obligations (acheter bas) et revenir √† 60/40.",
                                quantitative_formula: "Volatilit√© Portefeuille < Somme Volatilit√©s Individuelles",
                                quantitative_text: "En combinant des actifs non corr√©l√©s (qui ne bougent pas ensemble), on r√©duit le risque global sans forc√©ment r√©duire la performance.",
                                example: "Votre portefeuille crypto fait x2. C'est g√©nial, mais maintenant la crypto repr√©sente 80% de votre patrimoine. Si √ßa crash, vous perdez tout.<br>Strat√©gie saine : Vendre une partie de la crypto pour acheter de l'immobilier ou des actions stables. Vous 's√©curisez' vos gains."
                            },
                            quiz: {
                                question: "Pourquoi r√©√©quilibrer son portefeuille ?",
                                options: ["Pour payer plus de frais", "Pour maintenir son niveau de risque cible", "C'est inutile"],
                                correct: "Pour maintenir son niveau de risque cible"
                            }
                        }
                    ]
                }
            ],

            get currentModule() {
                return this.modules.find(m => m.id === this.activeModule);
            },

            get totalProgress() {
                let totalLessons = 0;
                let completedCount = 0;
                this.modules.forEach(m => {
                    m.lessons.forEach((l, idx) => {
                        totalLessons++;
                        if (this.isCompleted(m.id, idx)) completedCount++;
                    });
                });
                return totalLessons === 0 ? 0 : Math.round((completedCount / totalLessons) * 100);
            },

            getModuleProgress(module) {
                let total = module.lessons.length;
                let completed = 0;
                module.lessons.forEach((l, idx) => {
                    if (this.isCompleted(module.id, idx)) completed++;
                });
                return Math.round((completed / total) * 100);
            },

            isCompleted(moduleId, lessonIndex) {
                const key = `${moduleId}-${lessonIndex}`;
                return !!this.completedLessons[key];
            },

            openLesson(lesson, index) {
                this.activeLesson = { ...lesson }; // clone
                this.activeLessonIndex = index;
                this.activeLesson['quizCompleted'] = this.isCompleted(this.activeModule, index);
                this.quizError = false;
            },

            closeLesson() {
                this.activeLesson = null;
                this.activeLessonIndex = null;
            },

            checkQuiz(option) {
                if (option === this.activeLesson.quiz.correct) {
                    this.activeLesson.quizCompleted = true;
                    this.markAsCompleted(this.activeModule, this.activeLessonIndex);
                    this.quizError = false;
                    // Trigger confetti or sound here if desired
                } else {
                    this.quizError = true;
                    setTimeout(() => this.quizError = false, 2000);
                }
            },

            markAsCompleted(moduleId, lessonIndex) {
                const key = `${moduleId}-${lessonIndex}`;
                this.completedLessons[key] = true;
                localStorage.setItem('academy_progress_v2', JSON.stringify(this.completedLessons));
            }
        }
    }
</script>
{% endblock %}